<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ICT942: Research Articles Summary</title>
  
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f0f2f5;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .header {
      background-color: #1a73e8;
      color: white;
      padding: 16px 24px;
    }
    
    h1 {
      font-size: 24px;
      font-weight: 600;
    }
    
    h2 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
    }
    
    .section {
      padding: 24px;
      border-bottom: 1px solid #e1e4e8;
    }
    
    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
      color: #555;
    }
    
    input, textarea, select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 14px;
      transition: border-color 0.2s;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #1a73e8;
      box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
    }
    
    button {
      cursor: pointer;
      background-color: #1a73e8;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: #1558b3;
    }
    
    .button-red {
      background-color: #e53e3e;
    }
    
    .button-red:hover {
      background-color: #c53030;
    }
    
    .button-green {
      background-color: #38a169;
    }
    
    .button-green:hover {
      background-color: #2f855a;
    }
    
    .form-row {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }
    
    .form-group {
      flex: 1;
    }
    
    .table-container {
      overflow-x: auto;
      margin-top: 16px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th {
      background-color: #f1f5f9;
      text-align: left;
      padding: 10px;
      font-size: 13px;
      font-weight: 600;
      color: #4b5563;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    td {
      padding: 8px;
      border-bottom: 1px solid #e5e7eb;
      vertical-align: top;
    }
    
    .remove-btn {
      background: none;
      border: none;
      color: #e53e3e;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      padding: 0 8px;
    }
    
    .figures-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .figure-item {
      border: 1px solid #d1d5db;
      border-radius: 4px;
      padding: 12px;
      position: relative;
    }
    
    .figure-image {
      width: 100%;
      height: 180px;
      object-fit: contain;
      margin-bottom: 8px;
    }
    
    .figure-name {
      font-size: 14px;
      color: #6b7280;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .warning-text {
      color: #d97706;
      font-size: 14px;
      margin-top: 8px;
    }
    
    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px;
      background-color: #f9fafb;
    }
    
    .system-info {
      font-size: 13px;
      color: #6b7280;
    }
    
    .summaries-container {
      margin-top: 20px;
    }
    
    .summary-item {
      margin-bottom: 20px;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      padding: 15px;
    }
    
    .summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .action-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    /* New Tab Navigation Styles */
    .tabs {
      background-color: #f9fafb;
      display: flex;
      overflow-x: auto;
      border-bottom: 1px solid #e5e7eb;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .tab {
      padding: 12px 20px;
      cursor: pointer;
      white-space: nowrap;
      color: #4b5563;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
      font-weight: 500;
    }
    
    .tab:hover {
      background-color: #f3f4f6;
      color: #1a73e8;
    }
    
    .tab.active {
      color: #1a73e8;
      border-bottom-color: #1a73e8;
      background-color: white;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Progress indicator */
    .progress-bar {
      height: 6px;
      background-color: #e5e7eb;
      border-radius: 3px;
      margin-top: 10px;
    }
    
    .progress-fill {
      height: 100%;
      background-color: #1a73e8;
      border-radius: 3px;
      width: 0;
      transition: width 0.3s;
    }
    
    /* Quick Actions Panel */
    .quick-actions {
      position: fixed;
      right: 20px;
      bottom: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1000;
    }
    
    .action-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .floating-nav {
      position: fixed;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1000;
      background-color: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .nav-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: #d1d5db;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .nav-dot.active {
      background-color: #1a73e8;
      transform: scale(1.3);
    }
    
    /* Improved card styles */
    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid #e5e7eb;
      transition: all 0.3s;
    }
    
    .card:hover {
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      transform: translateY(-2px);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
        gap: 8px;
      }
      
      .figures-grid {
        grid-template-columns: 1fr;
      }
      
      .tab {
        padding: 10px 15px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>Lab 02: Research Articles Summary</h1>
    </div>
    
    <!-- Tab Navigation -->
    <div class="tabs" id="main-tabs">
      <div class="tab active" data-tab="info">Student Info</div>
      <div class="tab" data-tab="articles">Research Articles</div>
      <div class="tab" data-tab="figures">Research Figures</div>
      <div class="tab" data-tab="summaries">Article Summaries</div>
      <div class="tab" data-tab="preview">Preview & Export</div>
    </div>
    
    <!-- Tab Content -->
    <div id="info" class="tab-content active">
      <div class="section">
        <div class="card">
          <div class="card-header">
            <h2>Student Information</h2>
            <div class="progress-bar">
              <div class="progress-fill" id="info-progress"></div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="student-name">Name</label>
              <input type="text" id="student-name" placeholder="Enter your name">
            </div>
            <div class="form-group">
              <label for="student-id">Student ID</label>
              <input type="text" id="student-id" placeholder="Enter your student ID">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="course-name">Course Name</label>
              <input type="text" id="course-name" placeholder="Enter your course name">
            </div>
            <div class="form-group">
              <label for="instructor-name">Instructor Name</label>
              <input type="text" id="instructor-name" placeholder="Enter instructor name">
            </div>
          </div>
          <div class="btn-group">
            <button id="next-to-articles" class="button-green">Next: Research Articles</button>
          </div>
        </div>
      </div>
    </div>
    
    <div id="articles" class="tab-content">
      <div class="section">
        <div class="card">
          <div class="card-header">
            <h2>Research Articles Summary (at least 5 articles related to your research topics)</h2>
            <div class="progress-bar">
              <div class="progress-fill" id="articles-progress"></div>
            </div>
          </div>
          
          <div class="action-bar">
            <div class="form-row" style="align-items: flex-end; margin-bottom: 0;">
              <div class="form-group">
                <label for="new-column-name">Add Custom Column</label>
                <input type="text" id="new-column-name" placeholder="Enter column name">
              </div>
              <button id="add-column-btn" style="height: 38px;">Add Column</button>
            </div>
            <button id="add-row-btn" class="button-green">Add Row</button>
          </div>
          
          <!-- Table -->
          <div class="table-container">
            <table id="research-table">
              <thead>
                <tr>
                  <th style="width: 50px;">Actions</th>
                  <th>Ref</th>
                  <th>Years</th>
                  <th>Datasets</th>
                  <th>Contributions</th>
                  <th>Merits & Limitations</th>
                  <th>Future Scope</th>
                </tr>
              </thead>
              <tbody>
                <tr data-row-id="1">
                  <td>
                    <button class="remove-btn" onclick="removeRow(1)">×</button>
                  </td>
                  <td>
                    <input type="text" onpaste="return false;">
                  </td>
                  <td>
                    <input type="text" onpaste="return false;">
                  </td>
                  <td>
                    <textarea rows="2" onpaste="return false;"></textarea>
                  </td>
                  <td>
                    <textarea rows="2" onpaste="return false;"></textarea>
                  </td>
                  <td>
                    <textarea rows="2" onpaste="return false;"></textarea>
                  </td>
                  <td>
                    <textarea rows="2" onpaste="return false;"></textarea>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="btn-group">
            <button id="back-to-info" class="button-red">Back: Student Info</button>
            <button id="next-to-figures" class="button-green">Next: Research Figures</button>
          </div>
        </div>
      </div>
    </div>
    
    <div id="figures" class="tab-content">
      <div class="section">
        <div class="card">
          <div class="card-header">
            <h2>Research Figures</h2>
            <div class="progress-bar">
              <div class="progress-fill" id="figures-progress"></div>
            </div>
          </div>
          
          <div>
            <label for="figure-upload">Upload Figures (at least 2 figures from a research article which is related to your research topics)</label>
            <input type="file" id="figure-upload" accept="image/*" multiple>
          </div>
          
          <div id="figures-container" class="figures-grid">
            <!-- Figures will be added here -->
          </div>
          
          <div id="figures-warning" class="warning-text">Please upload at least 2 research figures.</div>
          
          <div class="btn-group">
            <button id="back-to-articles" class="button-red">Back: Research Articles</button>
            <button id="next-to-summaries" class="button-green">Next: Article Summaries</button>
          </div>
        </div>
      </div>
    </div>
    
    <div id="summaries" class="tab-content">
      <div class="section">
        <div class="card">
          <div class="card-header">
            <h2>Article Summaries</h2>
            <div class="progress-bar">
              <div class="progress-fill" id="summaries-progress"></div>
            </div>
          </div>
          
          <button id="add-summary-btn" class="button-green">Add Summary</button>
          
          <div id="summaries-container" class="summaries-container">
            <div class="summary-item" data-summary-id="1">
              <div class="summary-header">
                <h3>Summary of Article 1</h3>
                <button class="remove-btn" onclick="removeSummary(1)">×</button>
              </div>
              <textarea rows="8" placeholder="Write a summary for this article..." onpaste="return false;"></textarea>
            </div>
          </div>
          
          <div class="btn-group">
            <button id="back-to-figures" class="button-red">Back: Research Figures</button>
            <button id="next-to-preview" class="button-green">Next: Preview & Export</button>
          </div>
        </div>
      </div>
    </div>
    
    <div id="preview" class="tab-content">
      <div class="section">
        <div class="card">
          <div class="card-header">
            <h2>Preview & Export</h2>
          </div>
          
          <div id="preview-content">
            <p>Click the button below to generate a print-friendly version of your assignment.</p>
          </div>
          
          <div class="btn-group">
            <button id="back-to-summaries" class="button-red">Back: Article Summaries</button>
            <button id="print-btn" class="button-green">Print Assignment</button>
            <button id="save-template-btn">Save as Template</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- System Info -->
    <div class="footer">
      <div class="system-info">
        <p id="date-info">Date: Loading...</p>
        <p id="platform-info">Platform: Loading...</p>
      </div>
    </div>
  </div>
  
  <!-- Floating Navigation Dots -->
  <div class="floating-nav" id="floating-nav">
    <div class="nav-dot active" data-tab="info" title="Student Info"></div>
    <div class="nav-dot" data-tab="articles" title="Research Articles"></div>
    <div class="nav-dot" data-tab="figures" title="Research Figures"></div>
    <div class="nav-dot" data-tab="summaries" title="Article Summaries"></div>
    <div class="nav-dot" data-tab="preview" title="Preview & Export"></div>
  </div>
  
  <!-- Quick Actions -->
  <div class="quick-actions">
    <button class="action-btn" id="print-quick-btn" title="Print Assignment">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="6 9 6 2 18 2 18 9"></polyline>
        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
        <rect x="6" y="14" width="12" height="8"></rect>
      </svg>
    </button>
    <button class="action-btn" id="save-quick-btn" title="Save Template">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
        <polyline points="17 21 17 13 7 13 7 21"></polyline>
        <polyline points="7 3 7 8 15 8"></polyline>
      </svg>
    </button>
  </div>

  <script>
    // Global state (only one table is used now)
    const app = {
      studentInfo: {
        name: '',
        id: '',
        course: '',
        instructor: ''
      },
      tables: {
        'main': {
          name: 'Main Research Table',
          rows: [{ id: 1, cells: {} }],
          columns: []
        }
      },
      currentTableId: 'main',
      summaries: [{ id: 1, text: '' }],
      figures: [],
      systemInfo: {
        date: new Date().toLocaleString(),
        userAgent: navigator.userAgent,
        platform: navigator.platform
      }
    };
    
    // Default column keys
    const DEFAULT_COLUMNS = ['ref', 'years', 'datasets', 'contributions', 'merits', 'future'];
    
    // Initialize
    function init() {
      // Update system info
      document.getElementById('date-info').textContent = `Date: ${app.systemInfo.date}`;
      document.getElementById('platform-info').textContent = `Platform: ${app.systemInfo.platform}`;
      
      // Set up event listeners
      setupEventListeners();
      setupTableRowHandlers();
      setupSummaryHandlers();
      setupTabNavigation();
      updateProgressBars();
      
      // Update date every minute
      setInterval(() => {
        app.systemInfo.date = new Date().toLocaleString();
        document.getElementById('date-info').textContent = `Date: ${app.systemInfo.date}`;
      }, 60000);
    }
    
    // Set up tab navigation
    function setupTabNavigation() {
      // Main tabs
      const tabs = document.querySelectorAll('.tab');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // Deactivate all tabs
          tabs.forEach(t => t.classList.remove('active'));
          
          // Deactivate all tab contents
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
          });
          
          // Activate current tab
          tab.classList.add('active');
          
          // Activate corresponding tab content
          const tabId = tab.dataset.tab;
          document.getElementById(tabId).classList.add('active');
          
          // Update floating nav
          updateFloatingNav(tabId);
        });
      });
      
      // Navigation buttons
      document.getElementById('next-to-articles').addEventListener('click', () => {
        document.querySelector('.tab[data-tab="articles"]').click();
      });
      
      document.getElementById('back-to-info').addEventListener('click', () => {
        document.querySelector('.tab[data-tab="info"]').click();
      });
      
      document.getElementById('next-to-figures').addEventListener('click', () => {
        document.querySelector('.tab[data-tab="figures"]').click();
      });
      
      document.getElementById('back-to-articles').addEventListener('click', () => {
        document.querySelector('.tab[data-tab="articles"]').click();
      });
      
      document.getElementById('next-to-summaries').addEventListener('click', () => {
        document.querySelector('.tab[data-tab="summaries"]').click();
      });
      
      document.getElementById('back-to-figures').addEventListener('click', () => {
        document.querySelector('.tab[data-tab="figures"]').click();
      });
      
      document.getElementById('next-to-preview').addEventListener('click', () => {
        document.querySelector('.tab[data-tab="preview"]').click();
      });
      
      document.getElementById('back-to-summaries').addEventListener('click', () => {
        document.querySelector('.tab[data-tab="summaries"]').click();
      });
      
      // Floating navigation dots
      const navDots = document.querySelectorAll('.nav-dot');
      
      navDots.forEach(dot => {
        dot.addEventListener('click', () => {
          document.querySelector(`.tab[data-tab="${dot.dataset.tab}"]`).click();
        });
      });
      
      // Quick action buttons
      document.getElementById('print-quick-btn').addEventListener('click', printAssignment);
      document.getElementById('save-quick-btn').addEventListener('click', saveTemplate);
    }
    
    // Update floating navigation
    function updateFloatingNav(activeTabId) {
      document.querySelectorAll('.nav-dot').forEach(dot => {
        if (dot.dataset.tab === activeTabId) {
          dot.classList.add('active');
        } else {
          dot.classList.remove('active');
        }
      });
    }
    
    // Update progress bars
    function updateProgressBars() {
      // Student info progress
      const infoFields = ['name', 'id', 'course', 'instructor'];
      const infoCompleted = infoFields.reduce((count, field) => 
        app.studentInfo[field] ? count + 1 : count, 0);
      const infoProgress = (infoCompleted / infoFields.length) * 100;
      document.getElementById('info-progress').style.width = `${infoProgress}%`;
      
      // Articles progress
      const articlesTable = app.tables[app.currentTableId];
      let filledCells = 0;
      let totalCells = 0;
      
      articlesTable.rows.forEach(row => {
        const cellKeys = [...DEFAULT_COLUMNS, ...articlesTable.columns.map(c => c.key)];
        cellKeys.forEach(key => {
          totalCells++;
          if (row.cells[key]) filledCells++;
        });
      });
      
      const articlesProgress = totalCells ? (filledCells / totalCells) * 100 : 0;
      document.getElementById('articles-progress').style.width = `${articlesProgress}%`;
      
      // Figures progress
      const figuresProgress = app.figures.length >= 2 ? 100 : (app.figures.length * 50);
      document.getElementById('figures-progress').style.width = `${figuresProgress}%`;
      
      // Summaries progress
      let filledSummaries = 0;
      app.summaries.forEach(summary => {
        if (summary.text && summary.text.trim().length > 0) {
          filledSummaries++;
        }
      });
      
      const summariesProgress = app.summaries.length ? (filledSummaries / app.summaries.length) * 100 : 0;
      document.getElementById('summaries-progress').style.width = `${summariesProgress}%`;
    }
    
    // Set up event listeners
    function setupEventListeners() {
      // Student info
      document.getElementById('student-name').addEventListener('input', e => {
        app.studentInfo.name = e.target.value;
        updateProgressBars();
      });
      
      document.getElementById('student-id').addEventListener('input', e => {
        app.studentInfo.id = e.target.value;
        updateProgressBars();
      });
      
      document.getElementById('course-name').addEventListener('input', e => {
        app.studentInfo.course = e.target.value;
        updateProgressBars();
      });
      
      document.getElementById('instructor-name').addEventListener('input', e => {
        app.studentInfo.instructor = e.target.value;
        updateProgressBars();
      });
      
      // Table actions (only add row & custom column)
      document.getElementById('add-row-btn').addEventListener('click', addRow);
      document.getElementById('add-column-btn').addEventListener('click', addColumn);
      
      // Figures
      document.getElementById('figure-upload').addEventListener('change', handleFigureUpload);
      
      // Summaries
      document.getElementById('add-summary-btn').addEventListener('click', addSummary);
      
      // Print & Save
      document.getElementById('print-btn').addEventListener('click', printAssignment);
      document.getElementById('save-template-btn').addEventListener('click', saveTemplate);
    }
    
    // Set up initial row handlers
    function setupTableRowHandlers() {
      const firstRow = document.querySelector('#research-table tbody tr');
      if (!firstRow) return;
      
      const rowId = parseInt(firstRow.dataset.rowId);
      const cells = firstRow.querySelectorAll('input, textarea');
      
      DEFAULT_COLUMNS.forEach((column, index) => {
        cells[index].addEventListener('input', e => {
          const table = app.tables[app.currentTableId];
          const row = table.rows.find(r => r.id === rowId);
          if (row) {
            row.cells[column] = e.target.value;
            updateProgressBars();
          }
        });
      });
    }
    
    // Set up summary handlers
    function setupSummaryHandlers() {
      const firstSummary = document.querySelector('.summary-item[data-summary-id="1"] textarea');
      if (firstSummary) {
        firstSummary.addEventListener('input', e => {
          const summary = app.summaries.find(s => s.id === 1);
          if (summary) {
            summary.text = e.target.value;
            updateProgressBars();
          }
        });
      }
    }
    
    // Render the current table (only one table exists)
    function renderTable() {
      const table = app.tables[app.currentTableId];
      const tbody = document.querySelector('#research-table tbody');
      const thead = document.querySelector('#research-table thead tr');
      
      // Clear existing rows
      tbody.innerHTML = '';
      
      // Reset headers (remove any custom columns)
      while (thead.children.length > DEFAULT_COLUMNS.length + 1) {
        thead.removeChild(thead.lastChild);
      }
      
      // Add custom column headers
      table.columns.forEach(column => {
        const th = document.createElement('th');
        th.textContent = column.label;
        th.dataset.columnKey = column.key;
        
        // Add remove button for custom column
        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-btn';
        removeBtn.textContent = '×';
        removeBtn.style.float = 'right';
        removeBtn.onclick = () => removeColumn(column.key);
        th.appendChild(removeBtn);
        
        thead.appendChild(th);
      });
      
      // Add rows to table body
      table.rows.forEach(row => {
        tbody.appendChild(createRowElement(row));
      });
    }
    
    // Create a row element for the table
    function createRowElement(rowData) {
      const tr = document.createElement('tr');
      tr.dataset.rowId = rowData.id;
      
      // Actions cell
      const actionsCell = document.createElement('td');
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      removeBtn.textContent = '×';
      removeBtn.onclick = () => removeRow(rowData.id);
      actionsCell.appendChild(removeBtn);
      tr.appendChild(actionsCell);
      
      // Default cells
      DEFAULT_COLUMNS.forEach(column => {
        const td = document.createElement('td');
        const input = (column === 'ref' || column === 'years') ? document.createElement('input') : document.createElement('textarea');
        if (input.tagName === 'TEXTAREA') {
          input.rows = 2;
        }
        input.value = rowData.cells[column] || '';
        input.onpaste = () => false;
        input.oninput = e => {
          rowData.cells[column] = e.target.value;
          updateProgressBars();
        };
        td.appendChild(input);
        tr.appendChild(td);
      });
      
      // Custom columns
      app.tables[app.currentTableId].columns.forEach(column => {
        const td = document.createElement('td');
        const textarea = document.createElement('textarea');
        textarea.rows = 2;
        textarea.value = rowData.cells[column.key] || '';
        textarea.onpaste = () => false;
        textarea.oninput = e => {
          rowData.cells[column.key] = e.target.value;
          updateProgressBars();
        };
        td.appendChild(textarea);
        tr.appendChild(td);
      });
      
      return tr;
    }
    
    // Add a new row to the table
    function addRow() {
      const table = app.tables[app.currentTableId];
      const newRowId = table.rows.length > 0 ? Math.max(...table.rows.map(r => r.id)) + 1 : 1;
      const newRow = { id: newRowId, cells: {} };
      table.rows.push(newRow);
      const tbody = document.querySelector('#research-table tbody');
      tbody.appendChild(createRowElement(newRow));
    }
    
    // Remove a row from the table
    function removeRow(rowId) {
      const table = app.tables[app.currentTableId];
      if (table.rows.length <= 1) return; // Do not remove the last row
      table.rows = table.rows.filter(r => r.id !== rowId);
      const row = document.querySelector(`tr[data-row-id="${rowId}"]`);
      if (row) row.remove();
    }
    
    // Add a custom column to the table
    function addColumn() {
      const input = document.getElementById('new-column-name');
      const columnName = input.value.trim();
      if (columnName === '') return;
      const table = app.tables[app.currentTableId];
      const key = columnName.toLowerCase().replace(/\s+/g, '_');
      if ([...DEFAULT_COLUMNS, ...table.columns.map(c => c.key)].includes(key)) {
        alert('A column with this name already exists.');
        return;
      }
      table.columns.push({ key, label: columnName });
      renderTable();
      input.value = '';
    }
    
    // Remove a custom column from the table
    function removeColumn(key) {
      const table = app.tables[app.currentTableId];
      table.columns = table.columns.filter(c => c.key !== key);
      table.rows.forEach(row => {
        if (row.cells[key]) delete row.cells[key];
      });
      renderTable();
    }
    
    // Handle figure file upload
    function handleFigureUpload(e) {
      const files = Array.from(e.target.files);
      files.forEach(file => {
        if (!file.type.startsWith('image/')) return;
        const reader = new FileReader();
        reader.onload = event => {
          const figureId = Date.now() + Math.random();
          app.figures.push({
            id: figureId,
            name: file.name,
            url: event.target.result
          });
          addFigureToDOM({
            id: figureId,
            name: file.name,
            url: event.target.result
          });
          updateFigureWarning();
        };
        reader.readAsDataURL(file);
      });
    }
    
    // Add a figure element to the DOM
    function addFigureToDOM(figure) {
      const container = document.getElementById('figures-container');
      const figureItem = document.createElement('div');
      figureItem.className = 'figure-item';
      figureItem.dataset.figureId = figure.id;
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      removeBtn.textContent = '×';
      removeBtn.style.position = 'absolute';
      removeBtn.style.top = '5px';
      removeBtn.style.right = '5px';
      removeBtn.onclick = () => removeFigure(figure.id);
      const img = document.createElement('img');
      img.className = 'figure-image';
      img.src = figure.url;
      img.alt = figure.name;
      const name = document.createElement('p');
      name.className = 'figure-name';
      name.textContent = figure.name;
      figureItem.appendChild(removeBtn);
      figureItem.appendChild(img);
      figureItem.appendChild(name);
      container.appendChild(figureItem);
    }
    
    // Remove a figure from state and DOM
    function removeFigure(figureId) {
      app.figures = app.figures.filter(fig => fig.id !== figureId);
      const figure = document.querySelector(`.figure-item[data-figure-id="${figureId}"]`);
      if (figure) figure.remove();
      updateFigureWarning();
    }
    
    // Update warning message for figures upload
    function updateFigureWarning() {
      document.getElementById('figures-warning').style.display = app.figures.length >= 2 ? 'none' : 'block';
    }
    
    // Add a new summary section
    function addSummary() {
      const container = document.getElementById('summaries-container');
      const newId = app.summaries.length > 0 ? Math.max(...app.summaries.map(s => s.id)) + 1 : 1;
      app.summaries.push({ id: newId, text: '' });
      const summaryItem = document.createElement('div');
      summaryItem.className = 'summary-item';
      summaryItem.dataset.summaryId = newId;
      const header = document.createElement('div');
      header.className = 'summary-header';
      const title = document.createElement('h3');
      title.textContent = `Summary of Article ${newId}`;
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      removeBtn.textContent = '×';
      removeBtn.onclick = () => removeSummary(newId);
      const textarea = document.createElement('textarea');
      textarea.rows = 8;
      textarea.placeholder = 'Write a summary for this article...';
      textarea.onpaste = () => false;
      textarea.oninput = e => {
        const summary = app.summaries.find(s => s.id === newId);
        if (summary) {
          summary.text = e.target.value;
          updateProgressBars();
        }
      };
      header.appendChild(title);
      header.appendChild(removeBtn);
      summaryItem.appendChild(header);
      summaryItem.appendChild(textarea);
      container.appendChild(summaryItem);
    }
    
    // Remove a summary section
    function removeSummary(summaryId) {
      if (app.summaries.length <= 1) {
        alert('You must keep at least one summary section.');
        return;
      }
      app.summaries = app.summaries.filter(s => s.id !== summaryId);
      const summaryItem = document.querySelector(`.summary-item[data-summary-id="${summaryId}"]`);
      if (summaryItem) summaryItem.remove();
    }
    
    // Print assignment: generate a print-friendly version in a new window
    function printAssignment() {
      // Build a print-friendly HTML, including a static "Assignment Overview" section
      const printWindow = window.open('', '_blank');
      let printContent = `
        <!DOCTYPE html>
        <html>
        <head>
          <title>Research Assignment - ${app.studentInfo.name || 'Student'}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.5; }
            h1, h2, h3 { margin-top: 20px; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            th { background-color: #f2f2f2; }
            .student-info { margin: 20px 0; }
            .assignment-overview { margin: 20px 0; }
            .summary { margin: 20px 0; }
            .figure { margin: 20px 0; page-break-inside: avoid; }
            .figure img { max-width: 100%; height: auto; }
            .system-info { font-size: 12px; color: #666; margin-top: 40px; }
            @media print { .page-break { page-break-before: always; } }
          </style>
        </head>
        <body>
          <h1>Research Articles Summary</h1>
          <div class="student-info">
            <p><strong>Student Name:</strong> ${app.studentInfo.name || 'Not provided'}</p>
            <p><strong>Student ID:</strong> ${app.studentInfo.id || 'Not provided'}</p>
            <p><strong>Course Name:</strong> ${app.studentInfo.course || 'Not provided'}</p>
            <p><strong>Instructor Name:</strong> ${app.studentInfo.instructor || 'Not provided'}</p>
            <p><strong>Date:</strong> ${app.systemInfo.date}</p>
          </div>
          <!-- Assignment Overview: Pre-filled static content ensuring more than 20 words -->
          <div class="assignment-overview">
            <h2>Assignment Overview</h2>
            <p>
              This research assignment requires students to summarize and analyze at least five research articles related to their academic topics. 
              The student must also upload relevant research figures and provide concise article summaries that demonstrate their understanding of the material.
              This report serves as a comprehensive reflection of the student’s research efforts and analytical skills.
            </p>
          </div>
      `;
      
      // Main research articles table
      const table = app.tables[app.currentTableId];
      printContent += `
        <h2>${table.name}</h2>
        <table>
          <thead>
            <tr>
              <th>Ref</th>
              <th>Years</th>
              <th>Datasets</th>
              <th>Contributions</th>
              <th>Merits & Limitations</th>
              <th>Future Scope</th>
              ${table.columns.map(col => `<th>${col.label}</th>`).join('')}
            </tr>
          </thead>
          <tbody>
      `;
      
      table.rows.forEach(row => {
        printContent += '<tr>';
        DEFAULT_COLUMNS.forEach(column => {
          printContent += `<td>${row.cells[column] || ''}</td>`;
        });
        table.columns.forEach(column => {
          printContent += `<td>${row.cells[column.key] || ''}</td>`;
        });
        printContent += '</tr>';
      });
      
      printContent += `
          </tbody>
        </table>
      `;
      
      // Research figures
      if (app.figures.length > 0) {
        printContent += `<h2>Research Figures</h2>`;
        app.figures.forEach(figure => {
          printContent += `
            <div class="figure">
              <img src="${figure.url}" alt="${figure.name}">
              <p>${figure.name}</p>
            </div>
          `;
        });
      }
      
      // Article summaries
      printContent += `<h2>Article Summaries</h2>`;
      app.summaries.forEach(summary => {
        printContent += `
          <div class="summary">
            <h3>Summary of Article ${summary.id}</h3>
            <p>${summary.text || ''}</p>
          </div>
        `;
      });
      
      // System info
      printContent += `
          <div class="system-info">
            <p>User Agent: ${app.systemInfo.userAgent}</p>
          </div>
        </body>
        </html>
      `;
      
      printWindow.document.write(printContent);
      printWindow.document.close();
      printWindow.print();
    }
    
    // Dummy function to simulate saving the template
    function saveTemplate() {
      alert('Template saved successfully!');
    }
    
    window.onload = init;
  </script>
</body>
</html>
